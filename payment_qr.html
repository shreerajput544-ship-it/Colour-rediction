<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #f5f5f5; padding-bottom: 20px; }
        .header { background: linear-gradient(135deg, #ff6a6a, #ff9a9a); padding: 20px; color: #fff; display: flex; align-items: center; font-size: 18px; font-weight: bold; }
        .back-btn { margin-right: 15px; cursor: pointer; font-size: 20px; }
        
        .qr-card { background: #fff; margin: 20px; padding: 30px; border-radius: 15px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .qr-title { font-size: 16px; color: #333; font-weight: bold; margin-bottom: 15px; }
        .qr-img { width: 200px; height: 200px; margin-bottom: 15px; }
        .amount-display { font-size: 32px; font-weight: bold; color: #2ecc71; margin-bottom: 10px; }
        
        .input-box { background: #fff; margin: 20px; padding: 20px; border-radius: 15px; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 13px; color: #666; margin-bottom: 5px; font-weight: 500; }
        .input-group input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; outline: none; font-size: 14px; }
        
        .confirm-btn { display: block; width: calc(100% - 40px); margin: 20px; padding: 15px; background: linear-gradient(135deg, #2ecc71, #27ae60); color: #fff; border: none; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3); }
        .confirm-btn:disabled { background: #ccc; box-shadow: none; }
    </style>
</head>
<body>
    <div class="header">
        <span class="back-btn" onclick="window.history.back()">←</span>
        <span>Scan & Pay</span>
    </div>

    <div class="qr-card">
        <div class="qr-title">Scan QR to Pay</div>
        <div class="amount-display">₹<span id="payAmount">0</span></div>
        <img id="qrImage" class="qr-img" src="" alt="QR Code">
        <p style="font-size:12px; color:#888;">Scan with any UPI App</p>
    </div>

    <div class="input-box">
        <div class="input-group">
            <label>Your UPI ID</label>
            <input type="text" id="upiId" placeholder="example@upi">
        </div>
        <div class="input-group">
            <label>UTR / Reference No.</label>
            <input type="text" id="utrNo" placeholder="Enter 12-digit UTR to verify">
        </div>
    </div>

    <button class="confirm-btn" onclick="submitPayment()">Proceed & Request</button>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const amount = parseFloat(urlParams.get('amount')) || 0;
        const method = urlParams.get('method') || 'UPI';
        
        if(amount === 0) {
            alert("Invalid Amount");
            window.history.back();
        }

        document.getElementById('payAmount').innerText = amount;
        
        // Generate QR Code
        const upiString = `upi://pay?pa=9389001203@pthdfc&pn=WinMore&am=${amount}&cu=INR`;
        const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(upiString)}`;
        document.getElementById('qrImage').src = qrUrl;

        function submitPayment() {
            const upi = document.getElementById('upiId').value;
            const utr = document.getElementById('utrNo').value;

            if(!upi || !upi.includes('@')) {
                alert("Please enter a valid UPI ID");
                return;
            }

            if(!utr || utr.length < 12) {
                alert("Please enter a valid 12-digit UTR/Reference No. to verify payment.");
                return;
            }

            const btn = document.querySelector('.confirm-btn');
            const originalText = btn.innerText;
            btn.innerText = "Verifying Payment Status...";
            btn.disabled = true;

            setTimeout(() => {
                // Simulate Verification: Fail if UTR is "000000000000", else Success
                const isSuccess = utr !== "000000000000";

                if (isSuccess) {
                    let txs = JSON.parse(localStorage.getItem('winmore_transactions') || '[]');
                    txs.unshift({ id: Date.now(), type: "Deposit", amount: amount, status: "Pending", desc: `${method} Deposit (${upi}) UTR:${utr}`, date: new Date().toLocaleString() });
                    localStorage.setItem('winmore_transactions', JSON.stringify(txs));

                    alert("Payment Request Submitted! Please wait for Admin Approval.");
                    window.location.href = 'account.html';
                } else {
                    alert("Payment Verification Failed. Invalid UTR or Bank Server Busy.");
                    btn.innerText = originalText;
                    btn.disabled = false;
                }
            }, 2000);
        }
    </script>
</body>
</html>